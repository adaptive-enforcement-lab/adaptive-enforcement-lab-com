name: Documentation Quality

on:
  workflow_call:
    inputs:
      fail_on_threshold:
        description: 'Fail the workflow if thresholds are exceeded'
        type: boolean
        default: true

permissions:
  contents: read

jobs:
  analyze:
    name: Analyze Documentation
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v6

      - name: Setup Go
        uses: actions/setup-go@v6
        with:
          go-version-file: tools/content-analyzer/go.mod

      - name: Build content-analyzer
        working-directory: tools/content-analyzer
        run: go build -o content-analyzer ./cmd/content-analyzer/

      - name: Generate readability report
        run: |
          ./tools/content-analyzer/content-analyzer docs/ --format report >> "$GITHUB_STEP_SUMMARY"

      - name: Check readability thresholds
        if: inputs.fail_on_threshold
        run: |
          ./tools/content-analyzer/content-analyzer docs/ --check

      - name: Check readability thresholds (warn only)
        if: ${{ !inputs.fail_on_threshold }}
        run: |
          ./tools/content-analyzer/content-analyzer docs/ --check || echo "::warning::Some documentation files exceed readability thresholds"
